<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Survey Form</title>
        <meta content="width=device-width, initial-scale=1.0" name="viewport">

        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet">
        <link href="style.css" rel="stylesheet">
    </head>
    <body>
        <div id="overlay">
            <div id="overlay-content">
                <img src="loading.gif" alt="">
                <h3>Submitting entry, please wait for a while. . .</h3>
            </div>
        </div>
        <div class="container">
            <div class="wrap-container">

                <!-- 3. As a user, I want to see a form with id="survey-form" -->
                <form id="survey-form" name="survey" class="form" action="form-display.html" method="GET">
                    <div class="header-info">
                        <!-- 1. As a user, I want to see a title with id="title" in H1 sized text -->
                        <h1 id="title">Survey Form</h1>

                        <!-- 2. As a user, I want to see a short explanation with id="description" in P sized text -->
                        <p id="description">Programming Language Analysis</p>
                    </div>

                    <!-- 10. For the name, email and number input fields inside the form I can see
                    corresponding labels that describes the purpose of each field with the
                    following ids: id="name-label", id="email-label", id="number-label" -->
                    <!-- 11. For the name, email and number fields, I want to see a placeholder text that gives me
                    a description or instructions for each field. -->
                    <div class="wrap" id="name-parent">
                        <label id="name-label" for="name">Full name</label>

                        <!-- 4. As a user, I want to be required to enter my name in a field with id="name".
                        (Inside form element) -->
                        <input onblur="onBlur('name-parent', 'name')" onfocus="focused('name-parent')" required class="field-focus" id="name" type="text" name="name" placeholder="">
                        <span class="focus-border">
                            <i></i>
                        </span>
                    </div>
                    <div class="wrap" id="email-parent">

                        <!-- 6. As a user, I want to see a validation error if I enter an email that is not formatted
                        correctly. -->
                        <label id="email-label" for="email">Email Address</label>

                        <!-- 5. As a user, I want to be required to enter my email in a field with id="email".
                        (Inside form element) - REQUIRED NOT YET IMPLEMENTED -->
                        <input onblur="onBlur('email-parent', 'email')" onfocus="focused('email-parent')" pattern="[a-zA-Z0-9.-_]{1,}@[a-zA-Z.-]{2,}[.]{1}[a-zA-Z]{2,}" required class="field-focus" id="email" type="email" name="email" placeholder="">
                        <span class="focus-border">
                            <i></i>
                        </span>
                    </div>
                    <div class="wrap" id="number-parent">
                        <label id="number-label" for="number">Age</label>

                        <!-- 7. As a user, I should be able to enter a number in a field with id="number" -->
                        <!-- 8. As a user, if I enter non-numbers in the number input, I want to see an HTML5 validation error -->
                        <!-- 9. As a user, if I enter numbers outside the range of the number input, which are defined
                        by the min and max attributes, I will see an HTML5 validation error -->
                        <input onblur="onBlur('number-parent', 'number')" onfocus="focused('number-parent')" required min="1" max="100" title="Age must be a number and only accepts from 1 to 100." pattern="^(100|[1-9][0-9]?)$" class="field-focus" id="number" type="text" name="age" placeholder="">
                        <span class="focus-border">
                            <i></i>
                        </span>
                    </div>

                    <!-- 12. Inside the form element, I want a select option from a dropdown that has a corresponding
                    id="dropdown" -->
                    <div class="wrap" id="select-parent">
                        <label class="field-label" for="dropdown">University (optional)</label>
                        <div class="custom-select field-focus">
                            <select id="dropdown" name="university">
                                <option value="0">Please choose</option>
                                <option value="University of Cebu - Banilad">University of Cebu - Banilad</option>
                                <option value="University of Lapu-Lapu Mandaue">University of Lapu-Lapu Mandaue</option>
                                <option value="Ateneo de Manila University">Ateneo de Manila University</option>
                                <option value="De La Salle University Manila">De La Salle University Manila</option>
                                <option value="Avion School">Avion School</option>
                            </select>
                        </div>  
                        <span class="focus-border">
                            <i></i>
                        </span>               
                    </div>

                    <!-- 14. Inside the form element, I want to select several fields from a series
                    of checkboxes, each of which must have a value attribute.-->
                    <div class="wrap no-border">
                        <fieldset class="group" id="checbox-parent"> 
                            <legend>USED LANGUAGES</legend> 
                            <ul class="checkbox"> 
                                <label class="container-checkbox">Java
                                    <input onchange="handleCheckbox()" name="language" type="checkbox" id="java"  value="java" type="checkbox">
                                    <span class="checkmark"></span>
                                </label>
                                <label class="container-checkbox">Python
                                    <input onchange="handleCheckbox()" name="language" id="python" value="python" type="checkbox">
                                    <span class="checkmark"></span>
                                </label>
                                <label class="container-checkbox">C
                                    <input onchange="handleCheckbox()" name="language" id="c" value="c" type="checkbox">
                                    <span class="checkmark"></span>
                                </label>
                                <label class="container-checkbox">Ruby Javascript
                                    <input onchange="handleCheckbox()" name="language" onchange="handleCheckbox()" id="ruby-javascript" value="ruby-javascript" type="checkbox">
                                    <span class="checkmark"></span>
                                </label>
                                <label class="container-checkbox">C#
                                    <input onchange="handleCheckbox()" name="language" id="c#" value="c#" type="checkbox">
                                    <span class="checkmark"></span>
                                </label>
                                <label class="container-checkbox">PHP
                                    <input onchange="handleCheckbox()" name="language" id="php" value="php" type="checkbox">
                                    <span class="checkmark"></span>
                                </label>
                                <label class="container-checkbox">Objective-C
                                    <input onchange="handleCheckbox()" name="language" id="objective-c" value="objective-c" type="checkbox">
                                    <span class="checkmark"></span>
                                </label>
                                <label class="container-checkbox">SQL
                                    <input onchange="handleCheckbox()" name="language" id="sql" value="sql" type="checkbox">
                                    <span class="checkmark"></span>
                                </label>
                            </ul> 
                        </fieldset> 
                    </div>

                    <!-- 13. Inside the form element, I want to select a field from one or more groups of radion buttons.
                    Each group should be grouped using the name attribute -->
                    <div class="wrap no-border">
                        <label class="field-label" for="gender">Gender</label>
                        <div id="genders">
                            <input checked id="male" value="male" type="radio" name="gender">
                            <label class="radio" for="male">Male</label>
                            <input id="female" value="female" type="radio" name="gender">
                            <label class="radio" for="female">Female</label>
                        </div>
                    </div>

                    <!-- 15. Inside the form element, I want to see a textarea at the end for additional comments. -->
                    <div class="wrap" id="comment-parent">
                        <label class="field-label" for="comment">Experience</label>
                        <textarea required onblur="onBlur('comment-parent', 'comment')" onfocus="focused('comment-parent')" class="field-focus" name="comment" id="comment" cols="30" rows="4" placeholder=""></textarea>
                        <span class="focus-border">
                            <i></i>
                        </span>
                    </div>

                    <!-- 16. Inside the form element, I want to see a button with id="submit" to submit all my inputs -->
                    <!-- 17. I can submit my inputsto the address bar -->
                    <button type="submit" id="submit">Submit</button>
                </form>
                <div class="container-img">
                </div>
            </div>
        </div>
    </body>
<script>
let x, i, j, l, ll, selElmnt, a, b, c, y

/* Look for any elements with the class "custom-select" */
x = document.getElementsByClassName("custom-select")
l = x.length;
for (i = 0; i < l; i++) {
    selElmnt = x[i].getElementsByTagName("select")[0]
    ll = selElmnt.length

    /* For each element, create a new div that will act as the selected item */

    a = document.createElement("div")
    a.setAttribute("class", "select-selected")
    a.innerHTML = selElmnt.options[selElmnt.selectedIndex].innerHTML;
    x[i].appendChild(a)
    
    /* For each element, create a new DIV that will contain the option list */
    b = document.createElement("div")
    b.setAttribute("class", "select-items select-hide")
    for (j = 1; j < ll; j++) {

        /* For each option in the original select element,
        create a new DIV that will act as an option item */
        c = document.createElement("DIV")
        c.innerHTML = selElmnt.options[j].innerHTML
        c.addEventListener("click", function(e) {
            /* When an item is clicked, update the original select box,
            and the selected item */
            let i, k, s, h, sl, yl
            s = this.parentNode.parentNode.getElementsByTagName("select")[0]
            sl = s.length
            h = this.parentNode.previousSibling
            for (i = 0; i < sl; i++) {
                if (s.options[i].innerHTML == this.innerHTML) {
                    s.selectedIndex = i
                    h.innerHTML = this.innerHTML
                    y = this.parentNode.getElementsByClassName("same-as-selected")
                    yl = y.length

                    for (k = 0; k < yl; k++) {
                        y[k].removeAttribute("class")
                    }
                    
                    this.setAttribute("class", "same-as-selected")
                    break
                }
            }
            h.click()
        })
        b.appendChild(c)
    }
    x[i].appendChild(b)
    a.addEventListener("click", function(e) {

        /* When the select box is clicked, close any other select boxes,
        and open/close the current select box */
        e.stopPropagation()
        closeAllSelect(this)
        this.nextSibling.classList.toggle("select-hide")
        this.classList.toggle("select-arrow-active")
    })
}

function closeAllSelect(elmnt) {

    /* A function that will close all select boxes in the document,
    except the current select box */
    let x, y, i, xl, yl, arrNo = []
    x = document.getElementsByClassName("select-items")
    y = document.getElementsByClassName("select-selected")
    xl = x.length
    yl = y.length

    for (i = 0; i < yl; i++) {
        if (elmnt == y[i]) {
            arrNo.push(i)
        } else {
            y[i].classList.remove("select-arrow-active")
        }
    }

    for (i = 0; i < xl; i++) {
        if (arrNo.indexOf(i)) {
            x[i].classList.add("select-hide")
        }
    }
}

function handleSubmit (e) {
    e.preventDefault()
    surveyForm.reportValidity()

    validateInputField()
    validateChexbox()
    validateTextarea()

    if (surveyForm.reportValidity() && selected) {
        let overlay = document.getElementById('overlay')

        overlay.style.display = 'block'

        setTimeout(function () {
            overlay.style.display = 'none'
            HTMLFormElement.prototype.submit.call(surveyForm)
            surveyForm.reset()
        }, 4000)
    }
}

function validateInputField () {
    let inputs = document.querySelectorAll('input')
    
    for (let i = 0; i < inputs.length; i++) {
        let parent = document.getElementById(inputs[i].id).parentElement
        if (inputs[i].validity.valueMissing || !inputs[i].validity.valid) {
            parent.style.border = '1px solid red !important'
            inputs[i].focus()
        }
    }
}

function validateTextarea () {
    let comment = document.getElementById('comment')
    let parent = document.getElementById('comment-parent')
    
    if (!comment.validity.valid) {
        comment.focus()
        parent.style.border = '1px solid red !important'
    }
}

function validateChexbox () {
    let parent = document.getElementById('checbox-parent')

    for (let i = 0; i < checkboxes.length; i++) {
        if (checkboxes[i].checked) {
            selected = true
            break
        } else {
            selected = false
        }
    }
    
    if (!selected) {
        parent.style.border = '1px solid red'
    } else {
        parent.style.border = '1px solid #e6e6e6'
    }
}

function focused (parent) {
    document.getElementById(parent).style.border = 'none'
}

function onBlur (parent, elem) {
    document.getElementById(parent).style.border = '1px solid #e6e6e6'

    if (!document.getElementById(elem).validity.valid) {
        document.getElementById(parent).style.border = '1px solid red'
    } else {
        document.getElementById(parent).style.border = '1px solid #6675df'
    }
}

function handleCheckbox () {
    let parent = document.getElementById('checbox-parent')
    
    for (let i = 0; i < checkboxes.length; i++) {
        if (checkboxes[i].checked) {
            parent.style.border = '1px solid #e6e6e6'
            break
        } else {
            ctr++
        }
    }

    if (ctr == 8) {
        parent.style.border = '1px solid red'
    }
}

let ctr = 0
let surveyForm = document.forms.survey
let submit = document.getElementById('submit')
let checkboxes = document.querySelectorAll('input[type=checkbox]')
let selected = false

document.addEventListener('click', closeAllSelect)
submit.addEventListener('click', handleSubmit)
</script>
</html>
